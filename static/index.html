<!-- ... tu <head> y estilos ... -->
<body>
  <div id="chat"></div>
  <div id="input-area">
    <input id="texto" placeholder="Escribe tu consulta..." autocomplete="off"/>
    <button id="enviar">Enviar</button>
  </div>
  <script>
    const chatEl = document.getElementById('chat');
    const txtEl = document.getElementById('texto');
    const btnEl = document.getElementById('enviar');
    const history = [];  // Aquí guardamos el hilo

    function renderMessage(who, text) {
      // ... código para renderizar burbujas ...
    }

    btnEl.onclick = async () => {
      const text = txtEl.value.trim();
      if (!text) return;
      history.push({ role: 'user', content: text });
      renderMessage('user', text);
      txtEl.value = '';
      btnEl.disabled = true;

      try {
        const res = await fetch('/consulta', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ history })
        });
        const data = await res.json();
        const reply = data.respuesta || data.error;
        history.push({ role: 'assistant', content: reply });
        renderMessage('assistant', reply);
      } catch (err) {
        renderMessage('assistant', '❌ Error de conexión: ' + err.message);
      }
      btnEl.disabled = false;
    };

    txtEl.addEventListener('keypress', e => {
      if (e.key === 'Enter') btnEl.click();
    });
  </script>
</body>
</html>
